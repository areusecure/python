import requests
from jboss5 import *
from sys import argv as args


def check(host,port,uri,method):
	t = None
	
	try:
		if(host.index('\n') > 0):
			host = host[:host.index('\n')]
	except ValueError:
		pass
	proto = ""
	
	if(port==80 or port==8080):
		proto = "http"
	elif port == 443:
		proto = "https"
		
	print "proto %s"%(proto)	
	try:
		if method=="GET":
			t = requests.get(proto + "://" + host + uri)
		if method=="POST":
			t = requests.post(proto + "://" + host + uri)
		if t != None:	
			statuscode = t.status_code or ""
			jbossversion = t.headers["x-powered-by"] or ""
			wwwserver = t.headers["server"] or ""
			contenttype = t.headers["content-type"] or ""
			if statuscode == 200:
				print "URL: %s"%(uri)
				print "Server: " + host + " | port: " + str(port)
				print "Status code: " + str(statuscode)
				print "HTTP-method: %s"%(method)
				print "JBoss-version: " + str(jbossversion)
				print "WWW-server-version: " + str(wwwserver)
				print "Content-type: " + str(contenttype)
				print ""
				print "Version-check"
				e = jboss_exploit(host,port,False)
				print e.version()
				
	except requests.exceptions.ConnectionError as e:
		error = e.args[0].reason.strerror
		print "Host: %s on port %s caused Error: %s"%(host,port,error)	

def main():
	ports = [80,443,8080,8083]
	jboss_get_urls = ['/web-console/Invoker','/invoker/JMXInvokerServlet']
	other_urls = ['/jmx-console','/web-console', '/status', '/admin','/.DS_Store','/administrator/','/README.txt','/CHANGELOG']
	jboss_post_urls = ['/invoker/EJBInvokerServlet']
	
	print ""
	
	if len(args) == 3:
		for uri in jboss_get_urls:
			check(args[1],int(args[2]),uri,"GET")
		for uri in jboss_post_urls:
			check(args[1],int(args[2]),uri,"POST")
	if len(args) == 2:
		for uri in jboss_get_urls:
			check(args[1],ports[0],uri,"GET")
		for uri in jboss_post_urls:
			check(args[1],ports[0],uri,"POST")
			
	elif len(args) == 1:	
		f = open("hosts.txt","r")
		for line in f:
			for port in ports:
				for uri in jboss_get_urls:
					check(line,port,uri,"GET")
				for uri in jboss_post_urls:
					check(line,port,uri,"POST")
			
if __name__ == "__main__":
	main()